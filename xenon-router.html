<link rel="import" href="../polymer/polymer.html"/>

<!--

`<xenon-router>` provides simple page routing with the url hashbang and standard browser navigation.

Example:

    <xenon-router>
        <div id="pageone">
            <h1>the first page</h1>
            <a href="#pagetwo">next</a>
        </div>
        <div id="pagetwo"> 
            <h1>the second page</h1>
            <a href="#pageone">prev</a>
        </div>
    </xenon-router>

@group Xenon Elements
@element xenon-router
@demo demo/index.html
-->

<dom-module id="xenon-router">
    <template>
        <style>
            /*::content .backg { animation: fadeinx 1.0s ease 0.2s both; }*/

            @keyframes fadeinx {
                from { opacity: 0.0; }
                to   { opacity: 1.0; }
            }
        </style>
        <content></content>
    </template>
    <script>
        Polymer({
            is: "xenon-router",

            ready: function () {
                var that = this; 
                window.addEventListener("hashchange", function (e) { that.navigate(window.location.hash); });
                var all = this.getEffectiveChildren();
                for (var i = 0; i < all.length; i++) {
                    this.toggleClass("backg", true, all[i]);
                    this._hashes.push("#" + all[i].id);
                }
                this.hash = (window.location.hash == "" || window.location.hash == null || window.location.hash == undefined) ? this._hashes[0] : window.location.hash;
            },

            properties: {
                /* Collection of all available ids */
                _hashes: { type: Array, value: [] },

                /* The current value of the hashbang in the url. This value will include the hash. ex. "#pagetwo" */
                hash: { type: String, observer: "_showChild" },

                /* Enable to show all routes always. All children of xenon-router will be visible. */
                debug: { type: Boolean, value: false }
            },

            /* Call this method to display the required child. For example: 
            *  `this.$.myrouter.navigate("#pagetwo");`
            */
            navigate: function (hash) {
                this.hash = hash;
            },

            selectNext: function() {
                var index = this._hashes.indexOf(this.hash) + 1;
                if (index == this._hashes.length) return false; 
                var newHash = this._hashes[index];
                window.location = newHash;
                window.scrollTo(0, 0);
                this.fire("xenon-scroll-top");
                return true;
            },

            /* Show the correct child based on the value of this.hash */
            _showChild: function () {
                var all = this.getEffectiveChildren();
                if (!this.debug) for (var i = 0; i < all.length; i++) {
                    all[i].hidden = true;
                } 
                // find the element to unhide
                var ele; 
                if (this.hash == '') {
                    ele = all[0];
                } else {
                    ele = this.queryEffectiveChildren(this.hash);
                }
                // unhide the element
                if (ele != undefined) {
                    var shouldShow;
                    if (typeof (ele.onShouldShow) === "function") {
                        shouldShow = ele.onShouldShow();
                        if (!shouldShow) {
                            var index = this._hashes.indexOf(this.hash) + 1;
                            this.hash = this._hashes[index];
                            return;
                        }
                    }
                    ele.hidden = false;
                    if (typeof (ele.onRouterShow) === "function") {
                        ele.onRouterShow();
                    }
                }
                window.scrollTo(0, 0);
                this.fire("xenon-scroll-top");
           }
        });
    </script>
</dom-module>
